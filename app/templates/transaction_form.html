{% extends "base.html" %}

{% block title %}‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ - ‡∏à‡∏î‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢{% endblock %}

{% block content %}
<div class="mobile-container">
    <!-- Header -->
    <div class="page-header">
        <div class="header-content">
            <h1>
                <i data-lucide="edit"></i>
                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            </h1>
            <p class="subtitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</p>
        </div>
    </div>

    <!-- Transaction Form -->
    <div class="form-container">
        <form id="transaction-form" class="transaction-form">
            <!-- Type Selection -->
            <div class="form-group">
                <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                <div class="type-toggle">
                    <button type="button" class="type-btn expense active" data-type="expense">
                        <i data-lucide="minus-circle"></i>
                        <span>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</span>
                    </button>
                    <button type="button" class="type-btn income" data-type="income">
                        <i data-lucide="plus-circle"></i>
                        <span>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</span>
                    </button>
                </div>
            </div>

            <!-- Amount -->
            <div class="form-group">
                <label for="amount" class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
                <div class="amount-input-wrapper">
                    <span class="currency">‡∏ø</span>
                    <input
                        type="number"
                        id="amount"
                        class="form-input amount-input"
                        placeholder="0.00"
                        step="0.01"
                        required
                    >
                </div>
            </div>

            <!-- Category -->
            <div class="form-group">
                <label for="category" class="form-label">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                <select id="category" class="form-select" required>
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                    <option value="food">üçî ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                    <option value="transport">üöó ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</option>
                    <option value="shopping">üõçÔ∏è ‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á</option>
                    <option value="entertainment">üé¨ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á</option>
                    <option value="utilities">üí° ‡∏Ñ‡πà‡∏≤‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏π‡∏õ‡πÇ‡∏†‡∏Ñ</option>
                    <option value="healthcare">üè• ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</option>
                    <option value="education">üìö ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                    <option value="other">üì¶ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                </select>
            </div>

            <!-- Note -->
            <div class="form-group">
                <label for="note" class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                <textarea
                    id="note"
                    class="form-textarea"
                    placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏´‡πâ‡∏≤‡∏á"
                    rows="3"
                ></textarea>
            </div>

            <!-- Date -->
            <div class="form-group">
                <label for="date" class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                <input
                    type="date"
                    id="date"
                    class="form-input"
                    required
                >
            </div>

            <!-- Submit Button -->
            <button type="submit" class="btn-primary">
                <i data-lucide="check"></i>
                <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
            </button>
        </form>
    </div>

    <!-- Bottom spacing -->
    <div class="footer-spacing"></div>
</div>

<!-- Sticky Footer Menu -->
<nav class="footer-menu">
    <a href="/app" class="menu-item">
        <i data-lucide="home"></i>
        <span>‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</span>
    </a>
    <a href="/transactions/new" class="menu-item active">
        <i data-lucide="plus-circle"></i>
        <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
    </a>
    <a href="/categories" class="menu-item">
        <i data-lucide="folder"></i>
        <span>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</span>
    </a>
</nav>
{% endblock %}

{% block extra_js %}
<script>
// Set today's date as default
document.getElementById('date').valueAsDate = new Date();

// Type toggle
const typeBtns = document.querySelectorAll('.type-btn');
let selectedType = 'expense';

typeBtns.forEach(btn => {
    btn.addEventListener('click', () => {
        typeBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedType = btn.dataset.type;
    });
});

// Check URL params for type
const urlParams = new URLSearchParams(window.location.search);
const typeParam = urlParams.get('type');
if (typeParam === 'income') {
    document.querySelector('.type-btn.income').click();
}

// Form submission
document.getElementById('transaction-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = {
        type: selectedType,
        amount: parseFloat(document.getElementById('amount').value),
        category_id: document.getElementById('category').value,
        note: document.getElementById('note').value,
        date: document.getElementById('date').value
    };

    try {
        // TODO: Send to API
        console.log('Transaction data:', formData);
        alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ Project)');
        window.location.href = '/app';
    } catch (error) {
        console.error('Error:', error);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
    }
});
</script>
{% endblock %}
