{% extends "base.html" %}

{% block title %}‡∏´‡∏°‡∏ß‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ - ‡∏à‡∏î‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢{% endblock %}

{% block content %}
<div class="mobile-container">
    <!-- Header -->
    <div class="page-header">
        <div class="header-content">
            <h1>
                <i data-lucide="folder"></i>
                ‡∏´‡∏°‡∏ß‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ
            </h1>
            <p class="subtitle">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</p>
        </div>
    </div>

    <!-- Category Tabs -->
    <div class="tabs">
        <button class="tab active" data-tab="expense">
            <i data-lucide="minus-circle"></i>
            <span>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</span>
        </button>
        <button class="tab" data-tab="income">
            <i data-lucide="plus-circle"></i>
            <span>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</span>
        </button>
    </div>

    <!-- Categories List - Expense -->
    <div class="tab-content active" id="expense-categories">
        <div class="category-list">
            <div class="category-item">
                <div class="category-icon">üçî</div>
                <div class="category-info">
                    <div class="category-name">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</div>
                    <div class="category-meta">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‚Ä¢ 12 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                </div>
                <div class="category-actions">
                    <button class="btn-icon">
                        <i data-lucide="edit-2"></i>
                    </button>
                </div>
            </div>

            <div class="category-item">
                <div class="category-icon">üöó</div>
                <div class="category-info">
                    <div class="category-name">‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</div>
                    <div class="category-meta">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‚Ä¢ 8 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                </div>
                <div class="category-actions">
                    <button class="btn-icon">
                        <i data-lucide="edit-2"></i>
                    </button>
                </div>
            </div>

            <div class="category-item">
                <div class="category-icon">üõçÔ∏è</div>
                <div class="category-info">
                    <div class="category-name">‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á</div>
                    <div class="category-meta">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‚Ä¢ 5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                </div>
                <div class="category-actions">
                    <button class="btn-icon">
                        <i data-lucide="edit-2"></i>
                    </button>
                </div>
            </div>

            <div class="category-item">
                <div class="category-icon">üé¨</div>
                <div class="category-info">
                    <div class="category-name">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á</div>
                    <div class="category-meta">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‚Ä¢ 3 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                </div>
                <div class="category-actions">
                    <button class="btn-icon">
                        <i data-lucide="edit-2"></i>
                    </button>
                </div>
            </div>

            <div class="category-item">
                <div class="category-icon">üí°</div>
                <div class="category-info">
                    <div class="category-name">‡∏Ñ‡πà‡∏≤‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏π‡∏õ‡πÇ‡∏†‡∏Ñ</div>
                    <div class="category-meta">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‚Ä¢ 4 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                </div>
                <div class="category-actions">
                    <button class="btn-icon">
                        <i data-lucide="edit-2"></i>
                    </button>
                </div>
            </div>

            <div class="category-item">
                <div class="category-icon">üè•</div>
                <div class="category-info">
                    <div class="category-name">‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</div>
                    <div class="category-meta">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‚Ä¢ 2 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                </div>
                <div class="category-actions">
                    <button class="btn-icon">
                        <i data-lucide="edit-2"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Categories List - Income -->
    <div class="tab-content" id="income-categories">
        <div class="category-list">
            <div class="category-item">
                <div class="category-icon">üí∞</div>
                <div class="category-info">
                    <div class="category-name">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                    <div class="category-meta">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö ‚Ä¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                </div>
                <div class="category-actions">
                    <button class="btn-icon">
                        <i data-lucide="edit-2"></i>
                    </button>
                </div>
            </div>

            <div class="category-item">
                <div class="category-icon">üìà</div>
                <div class="category-info">
                    <div class="category-name">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°</div>
                    <div class="category-meta">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö ‚Ä¢ 3 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                </div>
                <div class="category-actions">
                    <button class="btn-icon">
                        <i data-lucide="edit-2"></i>
                    </button>
                </div>
            </div>

            <div class="category-item">
                <div class="category-icon">üéÅ</div>
                <div class="category-info">
                    <div class="category-name">‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç</div>
                    <div class="category-meta">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö ‚Ä¢ 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                </div>
                <div class="category-actions">
                    <button class="btn-icon">
                        <i data-lucide="edit-2"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Category Button -->
    <div class="floating-action">
        <button class="btn-fab" id="add-category-btn">
            <i data-lucide="plus"></i>
        </button>
    </div>

    <!-- Bottom spacing -->
    <div class="footer-spacing"></div>
</div>

<!-- Sticky Footer Menu -->
{% set current_page = 'categories' %}
{% include 'components/footer_menu.html' %}
{% endblock %}

{% block extra_js %}
<script>
// Tab switching
const tabs = document.querySelectorAll('.tab');
const tabContents = document.querySelectorAll('.tab-content');

tabs.forEach(tab => {
    tab.addEventListener('click', () => {
        const targetTab = tab.dataset.tab;

        // Update active tab
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        // Update active content
        tabContents.forEach(content => {
            if (content.id === `${targetTab}-categories`) {
                content.classList.add('active');
            } else {
                content.classList.remove('active');
            }
        });
    });
});

// Add category button
document.getElementById('add-category-btn').addEventListener('click', async () => {
    const activeTab = document.querySelector('.category-tab.active').dataset.tab;
    const categoryName = prompt('‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà:');

    if (!categoryName || !categoryName.trim()) {
        return;
    }

    try {
        await API.post(buildApiUrl('categories'), {
            name_th: categoryName.trim(),
            type: activeTab,
            icon: activeTab === 'expense' ? 'üìÅ' : 'üí∞',
            color: '#6B7280'
        });

        showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        await loadCategories();

    } catch (error) {
        showToast(error.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÑ‡∏î‡πâ', 'error');
    }
});

// Load categories
async function loadCategories() {
    try {
        const result = await API.get(buildApiUrl('categories'));

        if (result.categories && result.categories.length > 0) {
            // TODO: Update category cards UI with real data
            console.log('Categories loaded:', result.categories);
        }
    } catch (error) {
        console.error('Error loading categories:', error);
    }
}

// Delete category
async function deleteCategory(categoryId) {
    if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
        return;
    }

    try {
        const result = await API.delete(buildApiUrl('categories') + `/${categoryId}`);

        if (result.warning) {
            showToast(result.warning, 'warning', 5000);
        } else {
            showToast('‡∏•‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        await loadCategories();

    } catch (error) {
        showToast(error.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÑ‡∏î‡πâ', 'error');
    }
}

// Edit category
async function editCategory(categoryId, currentName) {
    const newName = prompt('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:', currentName);

    if (!newName || !newName.trim() || newName === currentName) {
        return;
    }

    try {
        await API.put(buildApiUrl('categories') + `/${categoryId}`, {
            name_th: newName.trim()
        });

        showToast('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        await loadCategories();

    } catch (error) {
        showToast(error.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÑ‡∏î‡πâ', 'error');
    }
}

// Load on page ready
document.addEventListener('DOMContentLoaded', () => {
    loadCategories();
});
</script>
{% endblock %}
