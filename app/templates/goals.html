{% extends "base.html" %}

{% block title %}‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô - ‡∏à‡∏î‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢{% endblock %}

{% block content %}
<div class="mobile-container page-loading">
    <!-- Header -->
    <div class="page-header">
        <div class="header-content">
            <h1>
                <i data-lucide="target"></i>
                ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô{% if user %} - {{ user.display_name }}{% endif %}
            </h1>
            <p class="subtitle">‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</p>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="goals-stats">
        <div class="stat-card">
            <div class="stat-icon">
                <i data-lucide="target"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value" id="goals-count">0</div>
                <div class="stat-label">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</div>
            </div>
        </div>

        <div class="stat-card income">
            <div class="stat-icon">
                <i data-lucide="piggy-bank"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value" id="total-saved">‡∏ø0</div>
                <div class="stat-label">‡∏≠‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß</div>
            </div>
        </div>

        <div class="stat-card expense">
            <div class="stat-icon">
                <i data-lucide="flag"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value" id="avg-progress">0%</div>
                <div class="stat-label">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
            </div>
        </div>
    </div>

    <!-- Goals List -->
    <div class="section">
        <div class="goals-list">
            <!-- Empty State -->
            <div class="empty-state">
                <i data-lucide="target"></i>
                <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô</p>
                <p class="empty-subtitle">‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô</p>
            </div>
        </div>
    </div>

    <div class="footer-spacing"></div>
</div>

<!-- Floating Action Button -->
<div class="floating-action">
    <button class="btn-fab" id="add-goal-btn">
        <i data-lucide="plus"></i>
    </button>
</div>

<!-- Modal: Add/Edit Goal -->
<div class="modal" id="goal-modal">
    <div class="modal-overlay"></div>
    <div class="modal-content modal-large">
        <div class="modal-header income">
            <h2>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô</h2>
            <button class="modal-close">
                <i data-lucide="x"></i>
            </button>
        </div>
        <form class="modal-body" id="goal-form">
            <input type="hidden" id="goal-edit-id">
            <!-- ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ -->
            <div class="form-group">
                <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</label>
                <input type="text" class="form-input" id="goal-name" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ã‡∏∑‡πâ‡∏≠ iPhone, ‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß"
                    required>
            </div>

            <!-- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ -->
            <div class="form-group">
                <label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (THB)</label>
                <div class="amount-input-wrapper">
                    <span class="currency">‡∏ø</span>
                    <input type="number" class="form-input amount-input" id="goal-amount" placeholder="50000" required>
                </div>
            </div>

            <!-- ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ -->
            <div class="form-group">
                <label class="form-label">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</label>
                <input type="number" class="form-input" id="goal-months" placeholder="6" min="1" max="120" value="6"
                    required>
                <small class="form-hint">‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</small>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="btn-primary">
                <i data-lucide="check"></i>
                <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
            </button>
        </form>
    </div>
</div>

<!-- Modal: Add Contribution -->
<div class="modal" id="contribute-modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <div class="modal-header income">
            <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°</h2>
            <button class="modal-close">
                <i data-lucide="x"></i>
            </button>
        </div>
        <form class="modal-body" id="contribute-form">
            <input type="hidden" id="contribute-goal-id">
            <div class="form-group">
                <label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (THB)</label>
                <div class="amount-input-wrapper">
                    <span class="currency">‡∏ø</span>
                    <input type="number" class="form-input amount-input" id="contribute-amount" placeholder="5000"
                        required>
                </div>
            </div>
            <button type="submit" class="btn-primary">
                <i data-lucide="plus"></i>
                <span>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°</span>
            </button>
        </form>
    </div>
</div>

<!-- Modal: Withdraw -->
<div class="modal" id="withdraw-modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <div class="modal-header expense">
            <h2>‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°</h2>
            <button class="modal-close">
                <i data-lucide="x"></i>
            </button>
        </div>
        <form class="modal-body" id="withdraw-form">
            <input type="hidden" id="withdraw-goal-id">
            <div class="goal-current-info" id="withdraw-info"></div>
            <div class="form-group">
                <label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏≠‡∏ô (THB)</label>
                <div class="amount-input-wrapper">
                    <span class="currency">‡∏ø</span>
                    <input type="number" class="form-input amount-input" id="withdraw-amount" placeholder="1000"
                        required>
                </div>
            </div>
            <button type="submit" class="btn-danger">
                <i data-lucide="minus"></i>
                <span>‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</span>
            </button>
        </form>
    </div>
</div>

<!-- Footer Menu -->
{% set current_page = 'goals' %}
{% include 'components/footer_menu.html' %}
{% endblock %}

{% block extra_js %}
<script>
    // Modal controls
    const goalModal = document.getElementById('goal-modal');
    const contributeModal = document.getElementById('contribute-modal');
    const addBtn = document.getElementById('add-goal-btn');

    function openModal(modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeModal(modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
    }

    document.querySelectorAll('.modal-close, .modal-overlay').forEach(el => {
        el.addEventListener('click', (e) => {
            const modal = e.target.closest('.modal');
            if (modal) closeModal(modal);
        });
    });

    // Load goals
    async function loadGoals() {
        try {
            const result = await API.get(buildApiUrl('savings-goals'));
            const goalsList = document.querySelector('.goals-list');

            if (result.savings_goals && result.savings_goals.length > 0) {
                renderGoals(result.savings_goals);
            } else {
                goalsList.innerHTML = `
                <div class="empty-state">
                    <i data-lucide="target"></i>
                    <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô</p>
                    <p class="empty-subtitle">‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô</p>
                    <button class="btn-primary" onclick="openModal(goalModal)">
                        <i data-lucide="plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏£‡∏Å
                    </button>
                </div>
            `;
                lucide.createIcons();
            }
        } catch (error) {
            console.error('Error loading goals:', error);
        }
    }

    function renderGoals(goals) {
        const goalsList = document.querySelector('.goals-list');

        // Update stats
        let totalSaved = 0;
        let totalProgress = 0;

        goals.forEach(goal => {
            totalSaved += goal.current_amount || 0;
            totalProgress += goal.progress_percentage || 0;
        });

        document.getElementById('goals-count').textContent = goals.length;
        document.getElementById('total-saved').textContent = '‡∏ø' + (totalSaved / 100).toLocaleString('th-TH');
        document.getElementById('avg-progress').textContent = Math.round(totalProgress / goals.length) + '%';

        // Render cards
        goalsList.innerHTML = goals.map(goal => {
            const current = (goal.current_amount || 0) / 100;
            const target = goal.target_amount / 100;
            const progress = goal.progress_percentage || 0;
            const isCompleted = goal.is_completed;
            const isOverdue = goal.is_overdue;

            return `
            <div class="goal-card ${isCompleted ? 'completed' : ''} ${isOverdue ? 'overdue' : ''}" data-id="${goal.id}">
                <div class="goal-header">
                    <div class="goal-icon">
                        <i data-lucide="${isCompleted ? 'check-circle' : 'target'}"></i>
                    </div>
                    <div class="goal-info">
                        <h3 class="goal-name">${goal.name}</h3>
                        <p class="goal-target">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏ø${target.toLocaleString('th-TH')}</p>
                    </div>
                    <div class="goal-actions">
                        <button class="btn-icon edit" onclick="openEdit('${goal.id}', '${goal.name}', ${goal.target_amount}, ${goal.days_remaining || 30})" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                            <i data-lucide="edit-2"></i>
                        </button>
                        ${!isCompleted && current > 0 ? `
                            <button class="btn-icon withdraw" onclick="openWithdraw('${goal.id}', '${goal.name}', ${current})" title="‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
                                <i data-lucide="minus-circle"></i>
                            </button>
                        ` : ''}
                        ${!isCompleted ? `
                            <button class="btn-icon add" onclick="openContribute('${goal.id}')" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô">
                                <i data-lucide="plus-circle"></i>
                            </button>
                        ` : ''}
                        <button class="btn-icon delete" onclick="deleteGoal('${goal.id}')" title="‡∏•‡∏ö">
                            <i data-lucide="trash-2"></i>
                        </button>
                    </div>
                </div>
                
                <div class="goal-progress">
                    <div class="progress-bar">
                        <div class="progress-fill ${isCompleted ? 'complete' : ''}" style="width: ${Math.min(progress, 100)}%"></div>
                    </div>
                    <div class="progress-text">
                        <span>‡∏ø${current.toLocaleString('th-TH')} / ‡∏ø${target.toLocaleString('th-TH')}</span>
                        <span>${progress.toFixed(0)}%</span>
                    </div>
                </div>
                
                ${goal.days_remaining !== null && !isCompleted ? `
                    <div class="goal-footer">
                        <span class="days-remaining ${isOverdue ? 'overdue' : ''}">
                            <i data-lucide="calendar"></i>
                            ${isOverdue ? '‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î' : `‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å ${goal.days_remaining} ‡∏ß‡∏±‡∏ô`}
                        </span>
                    </div>
                ` : ''}
                
                ${isCompleted ? `
                    <div class="goal-footer completed">
                        <span class="completed-badge">
                            <i data-lucide="trophy"></i>
                            ‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß!
                        </span>
                    </div>
                ` : ''}
            </div>
        `;
        }).join('');

        lucide.createIcons();
    }

    // Open contribute modal
    function openContribute(goalId) {
        document.getElementById('contribute-goal-id').value = goalId;
        document.getElementById('contribute-amount').value = '';
        openModal(contributeModal);
    }

    // Open edit modal
    function openEdit(goalId, name, targetAmount, daysRemaining) {
        document.getElementById('goal-edit-id').value = goalId;
        document.getElementById('goal-name').value = name;
        document.getElementById('goal-amount').value = targetAmount / 100; // satang to baht
        document.getElementById('goal-months').value = Math.ceil(daysRemaining / 30) || 6;

        // Update modal header
        document.querySelector('#goal-modal .modal-header h2').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢';
        openModal(goalModal);
    }

    // Reset form when opening for add
    addBtn.addEventListener('click', () => {
        document.getElementById('goal-edit-id').value = '';
        document.getElementById('goal-form').reset();
        document.getElementById('goal-months').value = '6';
        document.querySelector('#goal-modal .modal-header h2').textContent = '‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô';
        openModal(goalModal);
    });

    // Create/Update goal
    document.getElementById('goal-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const submitBtn = e.target.querySelector('button[type="submit"]');
        submitBtn.disabled = true;

        const editId = document.getElementById('goal-edit-id').value;
        const isEdit = !!editId;

        const payload = {
            name: document.getElementById('goal-name').value,
            target_amount: Math.round(parseFloat(document.getElementById('goal-amount').value) * 100),
            months: parseInt(document.getElementById('goal-months').value)
        };

        try {
            if (isEdit) {
                await API.put(buildApiUrl('savings-goals', editId), payload);
                showToast('‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            } else {
                await API.post(buildApiUrl('savings-goals'), payload);
                showToast('‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            }
            closeModal(goalModal);
            document.getElementById('goal-form').reset();
            await loadGoals();
        } catch (error) {
            showToast(error.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
        } finally {
            submitBtn.disabled = false;
        }
    });

    // Add contribution
    document.getElementById('contribute-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const submitBtn = e.target.querySelector('button[type="submit"]');
        submitBtn.disabled = true;

        const goalId = document.getElementById('contribute-goal-id').value;
        const amount = Math.round(parseFloat(document.getElementById('contribute-amount').value) * 100);

        try {
            await API.post(buildApiUrl('savings-goals', goalId, 'contribute'), { amount });
            showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            closeModal(contributeModal);
            await loadGoals();
        } catch (error) {
            showToast(error.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
        } finally {
            submitBtn.disabled = false;
        }
    });

    // Withdraw modal
    const withdrawModal = document.getElementById('withdraw-modal');

    function openWithdraw(goalId, goalName, currentAmount) {
        document.getElementById('withdraw-goal-id').value = goalId;
        document.getElementById('withdraw-amount').value = '';
        document.getElementById('withdraw-info').innerHTML = `
            <div class="info-box">
                <strong>üéØ ${goalName}</strong><br>
                <span>‡∏¢‡∏≠‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ‡∏ø${currentAmount.toLocaleString('th-TH')}</span>
            </div>
        `;
        openModal(withdrawModal);
    }

    // Withdraw submit
    document.getElementById('withdraw-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const submitBtn = e.target.querySelector('button[type="submit"]');
        submitBtn.disabled = true;

        const goalId = document.getElementById('withdraw-goal-id').value;
        const amount = Math.round(parseFloat(document.getElementById('withdraw-amount').value) * 100);

        try {
            await API.post(buildApiUrl('savings-goals', goalId, 'withdraw'), { amount });
            showToast('‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            closeModal(withdrawModal);
            await loadGoals();
        } catch (error) {
            showToast(error.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
        } finally {
            submitBtn.disabled = false;
        }
    });

    // Delete goal
    async function deleteGoal(goalId) {
        if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;

        try {
            await API.delete(buildApiUrl('savings-goals', goalId));
            showToast('‡∏•‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            await loadGoals();
        } catch (error) {
            showToast(error.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
        }
    }

    // Load on page ready
    document.addEventListener('DOMContentLoaded', async () => {
        await loadGoals();

        const container = document.querySelector('.mobile-container');
        if (container) {
            container.classList.remove('page-loading');
            container.classList.add('fade-in');
        }

        lucide.createIcons();
    });
</script>

<style>
    /* Goals Stats */
    .goals-stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.75rem;
        padding: 0 1rem;
        margin-bottom: 1rem;
    }

    /* Goal Card */
    .goal-card {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 1rem;
        margin-bottom: 0.75rem;
        border: 1px solid var(--border-color);
    }

    .goal-card.completed {
        border-color: var(--income-color);
        background: color-mix(in srgb, var(--income-color) 5%, var(--card-bg));
    }

    .goal-card.overdue {
        border-color: var(--expense-color);
    }

    .goal-header {
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
        margin-bottom: 1rem;
    }

    .goal-icon {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--income-color);
        color: white;
        flex-shrink: 0;
    }

    .goal-card.completed .goal-icon {
        background: var(--income-color);
    }

    .goal-info {
        flex: 1;
        min-width: 0;
    }

    .goal-name {
        font-size: 1rem;
        font-weight: 600;
        margin: 0 0 0.25rem;
        color: var(--text-primary);
    }

    .goal-target {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin: 0;
    }

    .goal-actions {
        display: flex;
        gap: 0.5rem;
    }

    .btn-icon {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        border: none;
        background: var(--bg-secondary);
        color: var(--text-secondary);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
    }

    .btn-icon:hover {
        background: var(--income-color);
        color: white;
    }

    .btn-icon.delete:hover {
        background: var(--expense-color);
        color: white;
    }

    .btn-icon.edit:hover {
        background: #3b82f6;
        color: white;
    }

    .form-hint {
        display: block;
        font-size: 0.75rem;
        color: var(--text-secondary);
        margin-top: 0.25rem;
    }

    /* Progress */
    .goal-progress {
        margin-bottom: 0.75rem;
    }

    .progress-bar {
        height: 8px;
        background: var(--bg-secondary);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 0.5rem;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--income-color), #34d399);
        border-radius: 4px;
        transition: width 0.5s ease;
    }

    .progress-fill.complete {
        background: var(--income-color);
    }

    .progress-text {
        display: flex;
        justify-content: space-between;
        font-size: 0.875rem;
        color: var(--text-secondary);
    }

    /* Footer */
    .goal-footer {
        padding-top: 0.75rem;
        border-top: 1px solid var(--border-color);
    }

    .days-remaining {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
        color: var(--text-secondary);
    }

    .days-remaining.overdue {
        color: var(--expense-color);
    }

    .completed-badge {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--income-color);
        font-weight: 600;
    }

    .goal-footer.completed {
        text-align: center;
    }

    /* Withdraw button */
    .btn-icon.withdraw:hover {
        background: var(--expense-color);
        color: white;
    }

    .btn-icon.add:hover {
        background: var(--income-color);
        color: white;
    }

    /* Danger button */
    .btn-danger {
        width: 100%;
        padding: 1rem;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        background: var(--expense-color);
        color: white;
        transition: all 0.2s;
    }

    .btn-danger:hover {
        background: #dc2626;
        transform: translateY(-2px);
    }

    /* Info box */
    .info-box {
        background: var(--bg-secondary);
        padding: 1rem;
        border-radius: 12px;
        margin-bottom: 1rem;
        text-align: center;
    }

    .info-box strong {
        color: var(--text-primary);
        font-size: 1.1rem;
    }

    .info-box span {
        color: var(--text-secondary);
    }

    /* Card animations */
    .goal-card {
        animation: fadeInUp 0.3s ease;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Mobile touch improvements */
    @media (max-width: 480px) {
        .goal-actions {
            gap: 0.25rem;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            -webkit-tap-highlight-color: transparent;
        }

        .goal-card {
            padding: 0.875rem;
        }

        .goals-stats {
            gap: 0.5rem;
            padding: 0 0.75rem;
        }
    }
</style>
{% endblock %}