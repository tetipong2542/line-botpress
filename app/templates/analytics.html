{% extends "base.html" %}

{% block title %}รายงาน - จดรายรับรายจ่าย{% endblock %}

{% block content %}
<div class="mobile-container">
    <!-- Header -->
    <div class="page-header">
        <div class="header-content">
            <h1>
                <i data-lucide="bar-chart-2"></i>
                รายงาน
            </h1>
            <p class="subtitle">วิเคราะห์รายรับรายจ่าย</p>
        </div>
        <div class="analytics-actions">
            <a href="/analytics/advanced" class="btn-secondary">
                <i data-lucide="line-chart"></i>
                <span>ขั้นสูง</span>
            </a>
            <button class="btn-secondary" id="btn-export">
                <i data-lucide="download"></i>
                <span>Export</span>
            </button>
        </div>
    </div>

    <!-- Period Selector -->
    <div class="period-selector">
        <button class="period-nav" id="prev-period">
            <i data-lucide="chevron-left"></i>
        </button>
        <div class="period-display">
            <span id="current-period">มกราคม 2026</span>
        </div>
        <button class="period-nav" id="next-period">
            <i data-lucide="chevron-right"></i>
        </button>
    </div>

    <!-- Summary Cards with Recurring Breakdown -->
    <div class="analytics-summary-grid">
        <!-- Row 1: Income Breakdown -->
        <div class="summary-row income-row">
            <div class="summary-card regular-income">
                <div class="summary-icon">
                    <i data-lucide="circle"></i>
                </div>
                <div class="summary-content">
                    <div class="summary-label">ปกติ รายรับ</div>
                    <div class="summary-amount">฿0</div>
                </div>
            </div>

            <div class="summary-card recurring-income">
                <div class="summary-icon">
                    <i data-lucide="repeat"></i>
                </div>
                <div class="summary-content">
                    <div class="summary-label">ประจำ รายรับ</div>
                    <div class="summary-amount">฿0</div>
                </div>
            </div>

            <div class="summary-card total-income highlight">
                <div class="summary-icon">
                    <i data-lucide="trending-up"></i>
                </div>
                <div class="summary-content">
                    <div class="summary-label">รวม รายรับ</div>
                    <div class="summary-amount">฿0</div>
                </div>
            </div>
        </div>

        <!-- Row 2: Expense Breakdown -->
        <div class="summary-row expense-row">
            <div class="summary-card regular-expense">
                <div class="summary-icon">
                    <i data-lucide="circle"></i>
                </div>
                <div class="summary-content">
                    <div class="summary-label">ปกติ รายจ่าย</div>
                    <div class="summary-amount">฿0</div>
                </div>
            </div>

            <div class="summary-card recurring-expense">
                <div class="summary-icon">
                    <i data-lucide="repeat"></i>
                </div>
                <div class="summary-content">
                    <div class="summary-label">ประจำ รายจ่าย</div>
                    <div class="summary-amount">฿0</div>
                </div>
            </div>

            <div class="summary-card total-expense highlight">
                <div class="summary-icon">
                    <i data-lucide="trending-down"></i>
                </div>
                <div class="summary-content">
                    <div class="summary-label">รวม รายจ่าย</div>
                    <div class="summary-amount">฿0</div>
                </div>
            </div>
        </div>

        <!-- Row 3: Net Balance (Full Width) -->
        <div class="summary-row balance-row">
            <div class="summary-card net-balance highlight">
                <div class="summary-icon">
                    <i data-lucide="wallet"></i>
                </div>
                <div class="summary-content">
                    <div class="summary-label">คงเหลือสุทธิ</div>
                    <div class="summary-amount">฿0</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="section">
        <div class="section-header">
            <h2>
                <i data-lucide="bar-chart-2"></i>
                สัดส่วนรายจ่ายตามหมวดหมู่
            </h2>
        </div>
        <div class="chart-container" style="height: 300px;">
            <canvas id="categoryChart"></canvas>
        </div>
    </div>

    <!-- Top Categories -->
    <div class="section">
        <div class="section-header">
            <h2>
                <i data-lucide="trending-up"></i>
                หมวดหมู่ทั้งหมด
            </h2>
        </div>
        <div id="top-categories-list" class="category-stats">
            <!-- Populated by analytics.js -->
        </div>
    </div>

    <!-- This Month's Scheduled Payments -->
    <div class="section" id="monthly-payments-section">
        <div class="section-header">
            <h2>
                <i data-lucide="calendar-check"></i>
                รายการต้องจ่ายเดือนนี้
            </h2>
        </div>

        <!-- Payment Summary Cards -->
        <div class="payment-summary-grid" id="payment-summary">
            <div class="payment-summary-card">
                <div class="payment-icon recurring">
                    <i data-lucide="repeat"></i>
                </div>
                <div class="payment-info">
                    <span class="payment-label">รายจ่ายประจำ</span>
                    <span class="payment-value" id="monthly-recurring-expense">฿0</span>
                </div>
            </div>
            <div class="payment-summary-card">
                <div class="payment-icon loan">
                    <i data-lucide="landmark"></i>
                </div>
                <div class="payment-info">
                    <span class="payment-label">ค่างวดสินเชื่อ</span>
                    <span class="payment-value" id="monthly-loan-payment">฿0</span>
                </div>
            </div>
            <div class="payment-summary-card total">
                <div class="payment-icon total">
                    <i data-lucide="calculator"></i>
                </div>
                <div class="payment-info">
                    <span class="payment-label">รวมต้องจ่าย</span>
                    <span class="payment-value" id="monthly-total-payment">฿0</span>
                </div>
            </div>
        </div>

        <!-- Payment List -->
        <div class="payment-list" id="monthly-payment-list">
            <!-- Populated by JavaScript -->
            <div class="loading-placeholder">
                <i data-lucide="loader" class="spinning"></i>
                <span>กำลังโหลด...</span>
            </div>
        </div>
    </div>

    <!-- Bottom spacing -->
    <div class="footer-spacing"></div>
</div>

<!-- Sticky Footer Menu -->
{% set current_page = 'analytics' %}
{% include 'components/footer_menu.html' %}
{% endblock %}

{% block extra_js %}
<!-- Analytics JavaScript -->
<script src="{{ url_for('static', filename='js/analytics.js') }}"></script>
{% endblock %}